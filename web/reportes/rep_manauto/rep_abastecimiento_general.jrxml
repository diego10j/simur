<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="rep_abastecimiento_general" language="groovy" pageWidth="842" pageHeight="595" orientation="Landscape" columnWidth="802" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="8601b10b-34f0-454b-99ed-0388b805bbe7">
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<parameter name="SUBREPORT_DIR" class="java.lang.String"/>
	<parameter name="anio" class="java.lang.String"/>
	<parameter name="mes" class="java.lang.String"/>
	<parameter name="periodo" class="java.lang.String"/>
	<parameter name="tipo" class="java.lang.String"/>
	<queryString>
		<![CDATA[select * from
(select y.*,
(case when a.galones is null then '0' when a.galones is not null then a.galones end) as galones,
(case when b.total is null then '0' when b.total is not null then b.total end) as total,
(case when c.kilometros is null then '0' when c.kilometros is not null then c.kilometros end) as recorrido,
(case when d.mantenimiento is null then '0' when d.mantenimiento is not null then d.mantenimiento end) as valor_mantenimiento from
(select v.mve_placa
FROM mvabactecimiento_combustible a
INNER JOIN mv_vehiculo v ON a.mve_secuencial = v.mve_secuencial
where a.abastecimiento_anio = $P{anio} and a.abastecimiento_periodo =$P{periodo} and a.abastecimiento_tipo_ingreso =$P{tipo}
GROUP BY v.mve_placa) as y
left join
(select round(sum(cast(a.abastecimiento_galones as NUMERIC)),2) as galones,v.mve_placa
FROM mvabactecimiento_combustible a
INNER JOIN mv_vehiculo v ON a.mve_secuencial = v.mve_secuencial
where a.abastecimiento_anio = $P{anio} and a.abastecimiento_periodo =$P{periodo} and a.abastecimiento_tipo_ingreso =$P{tipo}
GROUP BY v.mve_placa) as a
on y.mve_placa=a.mve_placa
left join
(select round(sum(abastecimiento_total),2) as total,v.mve_placa
FROM mvabactecimiento_combustible a
INNER JOIN mv_vehiculo v ON a.mve_secuencial = v.mve_secuencial
where a.abastecimiento_anio = $P{anio} and a.abastecimiento_periodo =$P{periodo} and a.abastecimiento_tipo_ingreso =$P{tipo}
GROUP BY v.mve_placa) as b
on y.mve_placa=b.mve_placa
left join
(select * from
(select z.*,(b.recorrido-a.recorrido) as kilometros from
(select v.mve_placa
FROM mvabactecimiento_combustible a
INNER JOIN mv_vehiculo v ON a.mve_secuencial = v.mve_secuencial
where a.abastecimiento_anio = $P{anio} and a.abastecimiento_periodo =$P{periodo} and a.abastecimiento_tipo_ingreso =$P{tipo}
GROUP BY v.mve_placa) as z
left join
(select
(case when min(a.abastecimiento_kilometraje) is null then round(EXTRACT(EPOCH FROM min(a.abastecimiento_valorhora) ::time))
when min(a.abastecimiento_kilometraje) is not null then round(min(a.abastecimiento_kilometraje),2) end )as recorrido
,v.mve_placa
FROM mvabactecimiento_combustible a
INNER JOIN mv_vehiculo v ON a.mve_secuencial = v.mve_secuencial
where a.abastecimiento_anio = $P{anio} and a.abastecimiento_periodo =$P{periodo} and a.abastecimiento_tipo_ingreso =$P{tipo}
GROUP BY v.mve_placa) as a
on z.mve_placa=a.mve_placa
left JOIN
(select
(case when max(a.abastecimiento_kilometraje) is null then round(EXTRACT(EPOCH FROM max(a.abastecimiento_valorhora) ::time))
when max(a.abastecimiento_kilometraje) is not null then round(max(a.abastecimiento_kilometraje),2) end )as recorrido
,v.mve_placa
FROM mvabactecimiento_combustible a
INNER JOIN mv_vehiculo v ON a.mve_secuencial = v.mve_secuencial
where a.abastecimiento_anio = $P{anio} and a.abastecimiento_periodo =$P{periodo} and a.abastecimiento_tipo_ingreso =$P{tipo}
GROUP BY v.mve_placa)as b
on z.mve_placa=b.mve_placa
) as p
order by mve_placa) as c
on y.mve_placa=c.mve_placa
left join
(SELECT round(sum(cast(d.mde_valor as NUMERIC)),2)
as mantenimiento,v.mve_placa
FROM mvdetalle_mantenimiento d
INNER JOIN mvcab_mantenimiento c ON d.mca_codigo = c.mca_codigo
INNER JOIN mv_vehiculo v ON c.mve_secuencial = v.mve_secuencial
where c.mca_anio = $P{anio} and c.mca_periodo = $P{periodo}
GROUP BY v.mve_placa) as d
on y.mve_placa=d.mve_placa
) as x
order by mve_placa]]>
	</queryString>
	<field name="mve_placa" class="java.lang.String"/>
	<field name="galones" class="java.math.BigDecimal"/>
	<field name="total" class="java.math.BigDecimal"/>
	<field name="recorrido" class="java.lang.Double"/>
	<field name="valor_mantenimiento" class="java.math.BigDecimal"/>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="98" splitType="Stretch">
			<staticText>
				<reportElement uuid="ca2d84d5-04b4-41ba-aa1b-2b50ee4a5cc0" key="staticText" x="10" y="44" width="266" height="34" forecolor="#000000" backcolor="#FFFFFF"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left">
					<font size="12" isBold="true" pdfFontName="Helvetica-Bold"/>
				</textElement>
				<text><![CDATA[ABASTECIMIENTO GENERAL]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="f0f7a99f-632c-43e2-bf70-e8fbbe69c39b" key="staticText" x="10" y="10" width="266" height="43" forecolor="#000000" backcolor="#FFFFFF"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left">
					<font size="12" isBold="true" pdfFontName="Helvetica-Bold"/>
				</textElement>
				<text><![CDATA[GOBIERNO AUTÓNOMO DESCENTRALIZADO MUNICIPAL DEL CANTON RUMIÑAHUI]]></text>
			</staticText>
			<image>
				<reportElement uuid="445d6533-21f7-44ca-8b3c-46f7d6326f08" x="506" y="0" width="200" height="98"/>
				<imageExpression><![CDATA[$P{SUBREPORT_DIR}+"/upload/logos/logo_reporte.png"]]></imageExpression>
			</image>
		</band>
	</title>
	<pageHeader>
		<band height="2" splitType="Stretch"/>
	</pageHeader>
	<columnHeader>
		<band height="2" splitType="Stretch"/>
	</columnHeader>
	<detail>
		<band height="2" splitType="Stretch"/>
	</detail>
	<columnFooter>
		<band height="2" splitType="Stretch"/>
	</columnFooter>
	<pageFooter>
		<band height="19" splitType="Stretch">
			<textField pattern="" isBlankWhenNull="false">
				<reportElement uuid="bbad5a25-0e25-4c78-a2bc-f2e1fe96ade6" key="textField-5" x="10" y="0" width="115" height="19" forecolor="#000000" backcolor="#FFFFFF"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement>
					<font size="10"/>
				</textElement>
				<textFieldExpression><![CDATA[new Date()]]></textFieldExpression>
			</textField>
			<textField pattern="" isBlankWhenNull="false">
				<reportElement uuid="c6814f92-5d52-4338-8a28-9ea8536637c8" key="textField" x="567" y="0" width="170" height="19" forecolor="#000000" backcolor="#FFFFFF"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Right">
					<font size="10"/>
				</textElement>
				<textFieldExpression><![CDATA["Página " + $V{PAGE_NUMBER} + " de "]]></textFieldExpression>
			</textField>
			<textField evaluationTime="Report" pattern="" isBlankWhenNull="false">
				<reportElement uuid="3983b149-9447-439e-a6f7-e88ce6382714" key="textField" x="737" y="0" width="36" height="19" forecolor="#000000" backcolor="#FFFFFF"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement>
					<font size="10"/>
				</textElement>
				<textFieldExpression><![CDATA["" + $V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
		</band>
	</pageFooter>
	<summary>
		<band height="303" splitType="Stretch">
			<lineChart>
				<chart>
					<reportElement uuid="97a40def-9e62-488d-a15d-c383666a3dac" x="0" y="15" width="802" height="287"/>
					<chartTitle position="Right"/>
					<chartSubtitle/>
					<chartLegend position="Right"/>
				</chart>
				<categoryDataset>
					<categorySeries>
						<seriesExpression><![CDATA["Kilometros"]]></seriesExpression>
						<categoryExpression><![CDATA[$F{mve_placa}]]></categoryExpression>
						<valueExpression><![CDATA[$F{recorrido}]]></valueExpression>
					</categorySeries>
					<categorySeries>
						<seriesExpression><![CDATA["Galones"]]></seriesExpression>
						<categoryExpression><![CDATA[$F{mve_placa}]]></categoryExpression>
						<valueExpression><![CDATA[$F{galones}]]></valueExpression>
					</categorySeries>
					<categorySeries>
						<seriesExpression><![CDATA["Total"]]></seriesExpression>
						<categoryExpression><![CDATA[$F{mve_placa}]]></categoryExpression>
						<valueExpression><![CDATA[$F{total}]]></valueExpression>
					</categorySeries>
					<categorySeries>
						<seriesExpression><![CDATA["Mantenimiento"]]></seriesExpression>
						<categoryExpression><![CDATA[$F{mve_placa}]]></categoryExpression>
						<valueExpression><![CDATA[$F{valor_mantenimiento}]]></valueExpression>
					</categorySeries>
				</categoryDataset>
				<linePlot>
					<plot/>
					<categoryAxisFormat>
						<axisFormat/>
					</categoryAxisFormat>
					<valueAxisFormat>
						<axisFormat/>
					</valueAxisFormat>
				</linePlot>
			</lineChart>
			<textField>
				<reportElement uuid="f9c36be6-d514-4681-927b-636e9706653b" x="384" y="1" width="100" height="20"/>
				<textElement/>
				<textFieldExpression><![CDATA[$P{anio}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement uuid="d8a8b920-c0e3-4564-be1c-c4461d7b0acb" x="318" y="1" width="100" height="20"/>
				<textElement/>
				<textFieldExpression><![CDATA[$P{mes}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement uuid="69a0109d-4fcb-4ad8-80f0-429f0e7545cb" x="377" y="1" width="33" height="20"/>
				<textElement/>
				<text><![CDATA[/]]></text>
			</staticText>
		</band>
	</summary>
</jasperReport>
