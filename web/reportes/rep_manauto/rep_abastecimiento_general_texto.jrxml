<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="rep_abastecimiento_general_texto" language="groovy" pageWidth="595" pageHeight="842" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="c512b1c6-2b6c-41ae-ac07-8872232a6f3f">
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<parameter name="SUBREPORT_DIR" class="java.lang.String"/>
	<parameter name="anio" class="java.lang.String"/>
	<parameter name="mes" class="java.lang.String"/>
	<parameter name="periodo" class="java.lang.String"/>
	<parameter name="tipo" class="java.lang.String"/>
	<queryString>
		<![CDATA[select * from
(select y.*,
(case when a.galones is null then '0' when a.galones is not null then a.galones end) as galones,
(case when b.total is null then '0' when b.total is not null then b.total end) as total,
(case when c.kilometros is null then '0' when c.kilometros is not null then c.kilometros end) as recorrido,
(case when d.mantenimiento is null then '0' when d.mantenimiento is not null then d.mantenimiento end) as valor_mantenimiento from
(select v.mve_placa
FROM mvabactecimiento_combustible a
INNER JOIN mv_vehiculo v ON a.mve_secuencial = v.mve_secuencial
where a.abastecimiento_anio = $P{anio} and a.abastecimiento_periodo =$P{periodo} and a.abastecimiento_tipo_ingreso =$P{tipo}
GROUP BY v.mve_placa) as y
left join
(select round(sum(cast(a.abastecimiento_galones as NUMERIC)),2) as galones,v.mve_placa
FROM mvabactecimiento_combustible a
INNER JOIN mv_vehiculo v ON a.mve_secuencial = v.mve_secuencial
where a.abastecimiento_anio = $P{anio} and a.abastecimiento_periodo =$P{periodo} and a.abastecimiento_tipo_ingreso =$P{tipo}
GROUP BY v.mve_placa) as a
on y.mve_placa=a.mve_placa
left join
(select round(sum(abastecimiento_total),2) as total,v.mve_placa
FROM mvabactecimiento_combustible a
INNER JOIN mv_vehiculo v ON a.mve_secuencial = v.mve_secuencial
where a.abastecimiento_anio = $P{anio} and a.abastecimiento_periodo =$P{periodo} and a.abastecimiento_tipo_ingreso =$P{tipo}
GROUP BY v.mve_placa) as b
on y.mve_placa=b.mve_placa
left join
(select * from
(select z.*,(b.recorrido-a.recorrido) as kilometros from
(select v.mve_placa
FROM mvabactecimiento_combustible a
INNER JOIN mv_vehiculo v ON a.mve_secuencial = v.mve_secuencial
where a.abastecimiento_anio = $P{anio} and a.abastecimiento_periodo =$P{periodo} and a.abastecimiento_tipo_ingreso =$P{tipo}
GROUP BY v.mve_placa) as z
left join
(select
(case when min(a.abastecimiento_kilometraje) is null then round(EXTRACT(EPOCH FROM min(a.abastecimiento_valorhora) ::time))
when min(a.abastecimiento_kilometraje) is not null then round(min(a.abastecimiento_kilometraje),2) end )as recorrido
,v.mve_placa
FROM mvabactecimiento_combustible a
INNER JOIN mv_vehiculo v ON a.mve_secuencial = v.mve_secuencial
where a.abastecimiento_anio = $P{anio} and a.abastecimiento_periodo =$P{periodo} and a.abastecimiento_tipo_ingreso =$P{tipo}
GROUP BY v.mve_placa) as a
on z.mve_placa=a.mve_placa
left JOIN
(select
(case when max(a.abastecimiento_kilometraje) is null then round(EXTRACT(EPOCH FROM max(a.abastecimiento_valorhora) ::time))
when max(a.abastecimiento_kilometraje) is not null then round(max(a.abastecimiento_kilometraje),2) end )as recorrido
,v.mve_placa
FROM mvabactecimiento_combustible a
INNER JOIN mv_vehiculo v ON a.mve_secuencial = v.mve_secuencial
where a.abastecimiento_anio = $P{anio} and a.abastecimiento_periodo =$P{periodo} and a.abastecimiento_tipo_ingreso =$P{tipo}
GROUP BY v.mve_placa)as b
on z.mve_placa=b.mve_placa
) as p
order by mve_placa) as c
on y.mve_placa=c.mve_placa
left join
(SELECT round(sum(cast(d.mde_valor as NUMERIC)),2)
as mantenimiento,v.mve_placa
FROM mvdetalle_mantenimiento d
INNER JOIN mvcab_mantenimiento c ON d.mca_codigo = c.mca_codigo
INNER JOIN mv_vehiculo v ON c.mve_secuencial = v.mve_secuencial
where c.mca_anio = $P{anio} and c.mca_periodo = $P{periodo}
GROUP BY v.mve_placa) as d
on y.mve_placa=d.mve_placa
) as x
order by mve_placa]]>
	</queryString>
	<field name="mve_placa" class="java.lang.String"/>
	<field name="galones" class="java.math.BigDecimal"/>
	<field name="total" class="java.math.BigDecimal"/>
	<field name="recorrido" class="java.lang.Double"/>
	<field name="valor_mantenimiento" class="java.math.BigDecimal"/>
	<variable name="SUMA" class="java.math.BigDecimal" resetType="Column" incrementType="Column">
		<variableExpression><![CDATA[$F{total}+$F{mantenimiento}]]></variableExpression>
	</variable>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="98" splitType="Stretch">
			<staticText>
				<reportElement uuid="73c4ee69-0525-468d-a880-247d7e8a51c1" key="staticText" x="10" y="44" width="266" height="20" forecolor="#000000" backcolor="#FFFFFF"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left">
					<font size="12" isBold="true" pdfFontName="Helvetica-Bold"/>
				</textElement>
				<text><![CDATA[CONSUMO TOTAL POR MES]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="e90c5dd2-b80d-4033-ba3b-014460e445fb" key="staticText" x="10" y="10" width="266" height="43" forecolor="#000000" backcolor="#FFFFFF"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left">
					<font size="12" isBold="true" pdfFontName="Helvetica-Bold"/>
				</textElement>
				<text><![CDATA[GOBIERNO AUTÓNOMO DESCENTRALIZADO MUNICIPAL DEL CANTON RUMIÑAHUI]]></text>
			</staticText>
			<textField>
				<reportElement uuid="86e09dcc-52bf-456a-b1fc-71cb61d21e3a" x="82" y="64" width="100" height="20"/>
				<textElement/>
				<textFieldExpression><![CDATA[$P{anio}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement uuid="6427a16b-1f99-4ce3-89a4-8bf596dce941" x="16" y="64" width="100" height="20"/>
				<textElement/>
				<textFieldExpression><![CDATA[$P{mes}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement uuid="aff62807-8ca1-46b2-8ea1-23fd452a7aaf" x="75" y="64" width="33" height="20"/>
				<textElement/>
				<text><![CDATA[/]]></text>
			</staticText>
			<image>
				<reportElement uuid="b2b158d0-f7f5-4e5a-bab3-37f97e606361" x="332" y="0" width="169" height="98"/>
				<imageExpression><![CDATA[$P{SUBREPORT_DIR}+"/upload/logos/logo_reporte.png"]]></imageExpression>
			</image>
		</band>
	</title>
	<pageHeader>
		<band height="2" splitType="Stretch"/>
	</pageHeader>
	<columnHeader>
		<band height="28" splitType="Stretch">
			<rectangle>
				<reportElement uuid="7aa0c158-0d44-45b6-a0b1-f2076c442612" x="4" y="6" width="549" height="20" backcolor="#666666"/>
			</rectangle>
			<staticText>
				<reportElement uuid="bb5b1840-52c4-4bf9-9ee7-ea9f88b7067e" x="4" y="5" width="73" height="20" forecolor="#FFFFFF"/>
				<textElement>
					<font size="9" isBold="true"/>
				</textElement>
				<text><![CDATA[PLACA/CODIGO]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="579b1625-f06e-438c-892c-ab887ad06488" x="75" y="5" width="100" height="20" forecolor="#FFFFFF"/>
				<textElement textAlignment="Right">
					<font size="9" isBold="true"/>
				</textElement>
				<text><![CDATA[TOTAL KM]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="0d67a331-2847-4a54-ad12-800d6ae98bd5" x="147" y="5" width="100" height="20" forecolor="#FFFFFF"/>
				<textElement textAlignment="Right">
					<font size="9" isBold="true"/>
				</textElement>
				<text><![CDATA[TOTAL GL]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="ad1802b9-e7ef-4f93-af2d-ab86f4e8226e" x="248" y="5" width="100" height="20" forecolor="#FFFFFF"/>
				<textElement textAlignment="Right">
					<font size="9" isBold="true"/>
				</textElement>
				<text><![CDATA[TOTAL CONSUMO]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="b2880075-8bbf-4a8b-b6ad-4cb95aaaf15d" x="357" y="5" width="114" height="20" forecolor="#FFFFFF"/>
				<textElement textAlignment="Right">
					<font size="9" isBold="true"/>
				</textElement>
				<text><![CDATA[TOTAL MANTENIMIENTO]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="a1771d0e-ebfd-44c1-9629-cd69647cd4bf" x="476" y="5" width="77" height="20" forecolor="#FFFFFF"/>
				<textElement textAlignment="Right">
					<font size="9" isBold="true"/>
				</textElement>
				<text><![CDATA[TOTAL GASTO]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="21" splitType="Stretch">
			<textField>
				<reportElement uuid="283f1942-315f-4f80-97a7-adab82c7a9bc" x="147" y="0" width="100" height="20" forecolor="#000000"/>
				<textElement textAlignment="Right">
					<font size="9"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{galones}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement uuid="b55cafcd-88db-4eef-85aa-115ffc297a85" x="248" y="0" width="100" height="20" forecolor="#000000"/>
				<textElement textAlignment="Right">
					<font size="9"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{total}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement uuid="621948b2-0aae-410b-8e98-0615f66d699a" x="75" y="0" width="100" height="20" forecolor="#000000"/>
				<textElement textAlignment="Right">
					<font size="9"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{recorrido}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement uuid="4594eb05-82f4-486a-93e4-2f81264459d1" x="4" y="0" width="73" height="20"/>
				<textElement>
					<font size="9"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{mve_placa}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement uuid="e6aefa85-3e44-4689-9d39-89a26aea63e9" x="357" y="0" width="114" height="20"/>
				<textElement textAlignment="Right">
					<font size="9"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{mantenimiento}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement uuid="4de13659-7ad5-4caa-9ee0-ef30c14e5c09" x="476" y="1" width="77" height="20"/>
				<textElement textAlignment="Right">
					<font size="9" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{SUMA}]]></textFieldExpression>
			</textField>
			<line>
				<reportElement uuid="e40cc3eb-911d-4b92-af38-07bb9665e251" x="10" y="19" width="543" height="1"/>
				<graphicElement>
					<pen lineStyle="Dashed"/>
				</graphicElement>
			</line>
		</band>
	</detail>
	<columnFooter>
		<band height="2" splitType="Stretch"/>
	</columnFooter>
	<pageFooter>
		<band height="26" splitType="Stretch">
			<textField pattern="" isBlankWhenNull="false">
				<reportElement uuid="6f165202-a9ea-4ea4-bc58-6e33ff55d645" key="textField" x="351" y="4" width="170" height="19" forecolor="#000000" backcolor="#FFFFFF"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Right">
					<font size="10"/>
				</textElement>
				<textFieldExpression><![CDATA["Página " + $V{PAGE_NUMBER} + " de "]]></textFieldExpression>
			</textField>
			<textField pattern="" isBlankWhenNull="false">
				<reportElement uuid="4a90fa6f-596e-4420-b907-feb84cbd11fd" key="textField-5" x="0" y="4" width="115" height="19" forecolor="#000000" backcolor="#FFFFFF"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement>
					<font size="10"/>
				</textElement>
				<textFieldExpression><![CDATA[new Date()]]></textFieldExpression>
			</textField>
			<textField evaluationTime="Report" pattern="" isBlankWhenNull="false">
				<reportElement uuid="036f2bce-07cf-4080-97cf-ea743dfa7397" key="textField" x="521" y="4" width="36" height="19" forecolor="#000000" backcolor="#FFFFFF"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement>
					<font size="10"/>
				</textElement>
				<textFieldExpression><![CDATA["" + $V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
		</band>
	</pageFooter>
	<summary>
		<band height="2" splitType="Stretch"/>
	</summary>
</jasperReport>
