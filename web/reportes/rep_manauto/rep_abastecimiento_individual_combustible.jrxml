<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="rep_abastecimiento_individual_combustible" language="groovy" pageWidth="842" pageHeight="595" orientation="Landscape" columnWidth="802" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="3866f0fe-ea46-439f-9b58-614d7af7099c">
	<property name="ireport.zoom" value="1.0000000000000004"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<parameter name="SUBREPORT_DIR" class="java.lang.String"/>
	<parameter name="anio" class="java.lang.String"/>
	<parameter name="placa" class="java.lang.String"/>
	<parameter name="periodo" class="java.lang.String"/>
	<parameter name="descripcion" class="java.lang.String"/>
	<parameter name="mes" class="java.lang.String"/>
	<parameter name="tipo" class="java.lang.String"/>
	<parameter name="modelo" class="java.lang.String"/>
	<queryString>
		<![CDATA[select cast(a.abastecimiento_numero as numeric),
a.mve_placa,
a.mve_codigo,
a.mvtipo_descripcion,
a.mvmarca_descripcion,
a.mvmodelo_descripcion,
(case when cast(b.abastecimiento_total as numeric) is null then 0 when cast(b.abastecimiento_total as numeric) is not null then  cast(b.abastecimiento_total as numeric) end)  as total,
(case when cast(c.abastecimiento_galones as numeric) is null then 0 when cast(c.abastecimiento_galones as numeric) is not null then  cast(c.abastecimiento_galones as numeric) end)  as galones,
(case when cast(d.mde_total as numeric) is null then 0 when cast(d.mde_total as numeric) is not null then  cast(d.mde_total as numeric) end)  as mantenimiento,
(case when cast (e.promedio as numeric) is null then 0 when cast (e.promedio as numeric) is not null then  cast (e.promedio as numeric) end)  as recorrido from
(SELECT
a.abastecimiento_numero,
v.mve_placa,
v.mve_codigo,
t.mvtipo_descripcion,
m.mvmarca_descripcion,
o.mvmodelo_descripcion
FROM mvabactecimiento_combustible AS a
INNER JOIN mv_vehiculo AS v ON a.mve_secuencial = v.mve_secuencial
INNER JOIN mvtipo_vehiculo t ON v.mvtipo_id = t.mvtipo_id
INNER JOIN mvmarca_vehiculo m ON v.mvmarca_id = m.mvmarca_id AND t.mvmarca_id = m.mvmarca_id
INNER JOIN mvmodelo_vehiculo o ON o.mvtipo_id = t.mvtipo_id AND v.mvmodelo_id = o.mvmodelo_id
WHERE (case when v.mve_placa is NULL then v.mve_codigo when v.mve_placa is not null then v.mve_placa end ) = '004406'
and a.abastecimiento_anio='2015' and a.abastecimiento_periodo='1'
ORDER BY a.abastecimiento_numero ASC) as a
left join
(SELECT
(SELECT count (*)
FROM mvabactecimiento_combustible a1
INNER JOIN mv_vehiculo v1 ON a1.mve_secuencial = v1.mve_secuencial
where (case when v1.mve_placa is NULL then v1.mve_codigo when v1.mve_placa is not null then v1.mve_placa end )= '004406'
and a1.abastecimiento_anio='2015' and a1.abastecimiento_periodo='1' and a1.abastecimiento_numero<=a.abastecimiento_numero) as numero,
a.abastecimiento_total,(case when v.mve_placa is NULL then v.mve_codigo when v.mve_placa is not null then v.mve_placa end ) as placa
FROM mvabactecimiento_combustible a
INNER JOIN mv_vehiculo v ON a.mve_secuencial = v.mve_secuencial
where (case when v.mve_placa is NULL then v.mve_codigo when v.mve_placa is not null then v.mve_placa end ) = '004406'
and a.abastecimiento_anio='2015' and a.abastecimiento_periodo='1'
order by numero) as b
on (case when a.mve_placa is NULL then a.mve_codigo when a.mve_placa is not null then a.mve_placa end )=b.placa
and a.abastecimiento_numero= cast(b.numero as varchar)
left join
(SELECT
(SELECT count (*)
FROM mvabactecimiento_combustible a1
INNER JOIN mv_vehiculo v1 ON a1.mve_secuencial = v1.mve_secuencial
where (case when v1.mve_placa is NULL then v1.mve_codigo when v1.mve_placa is not null then v1.mve_placa end )= '004406'
and a1.abastecimiento_anio='2015' and a1.abastecimiento_periodo='1' and a1.abastecimiento_numero<=a.abastecimiento_numero) as numero,
a.abastecimiento_galones,(case when v.mve_placa is NULL then v.mve_codigo when v.mve_placa is not null then v.mve_placa end ) as placa
FROM mvabactecimiento_combustible a
INNER JOIN mv_vehiculo v ON a.mve_secuencial = v.mve_secuencial
where (case when v.mve_placa is NULL then v.mve_codigo when v.mve_placa is not null then v.mve_placa end ) = '004406'
and a.abastecimiento_anio='2015' and a.abastecimiento_periodo='1'
order by numero) as c
on (case when a.mve_placa is NULL then a.mve_codigo when a.mve_placa is not null then a.mve_placa end )=c.placa
and a.abastecimiento_numero= cast(c.numero as varchar)
left join
(select
(SELECT count (*)
FROM mvdetalle_mantenimiento d
INNER JOIN mvcab_mantenimiento c ON d.mca_codigo = c.mca_codigo
INNER JOIN mv_vehiculo v ON c.mve_secuencial = v.mve_secuencial
where (case when v.mve_placa is NULL then v.mve_codigo when v.mve_placa is not null then v.mve_placa end ) = '004406'
and c.mca_anio='2015' and c.mca_periodo='1' and
d.mde_total <= d1.mde_total
) as numero,
d1.mde_total,(case when v1.mve_placa is NULL then v1.mve_codigo when v1.mve_placa is not null then v1.mve_placa end ) as placa
FROM mvdetalle_mantenimiento d1
INNER JOIN mvcab_mantenimiento c1 ON d1.mca_codigo = c1.mca_codigo
INNER JOIN mv_vehiculo v1 ON c1.mve_secuencial = v1.mve_secuencial
where (case when v1.mve_placa is NULL then v1.mve_codigo when v1.mve_placa is not null then v1.mve_placa end ) = '004406' and c1.mca_anio='2015' and c1.mca_periodo='1'
order by numero) as d
on (case when a.mve_placa is NULL then a.mve_codigo when a.mve_placa is not null then a.mve_placa end )=d.placa
and a.abastecimiento_numero= cast(d.numero as varchar)
left join
(select a.numero,a.placa,
(case when (cast(b.recorrido as numeric)-cast(a.recorrido as numeric)) is null then 0 when (cast(b.recorrido as numeric)-cast(a.recorrido as numeric)) is not null then (cast(b.recorrido as numeric)-cast(a.recorrido as numeric)) end ) as promedio
from
(select
(SELECT count (*)
FROM mvabactecimiento_combustible a1
INNER JOIN mv_vehiculo v1 ON a1.mve_secuencial = v1.mve_secuencial
where (case when a1.abastecimiento_kilometraje is null then a1.abastecimiento_horasto
when a1.abastecimiento_kilometraje is not null then cast(a1.abastecimiento_kilometraje as varchar) end ) <= (case when a.abastecimiento_kilometraje is null then a.abastecimiento_horasto
when a.abastecimiento_kilometraje is not null then cast(a.abastecimiento_kilometraje as varchar) end )
and  (case when v1.mve_placa is NULL then v1.mve_codigo when v1.mve_placa is not null then v1.mve_placa end ) = '004406'
and a.abastecimiento_anio='2015' and a.abastecimiento_periodo='1') as numero,
(case when a.abastecimiento_kilometraje is null then substring(a.abastecimiento_horasto,0,5)
when a.abastecimiento_kilometraje is not null then cast(a.abastecimiento_kilometraje as varchar) end ) as recorrido,
(case when v.mve_placa is NULL then v.mve_codigo when v.mve_placa is not null then v.mve_placa end ) AS placa
FROM mvabactecimiento_combustible a
INNER JOIN mv_vehiculo v ON a.mve_secuencial = v.mve_secuencial
where  (case when v.mve_placa is NULL then v.mve_codigo when v.mve_placa is not null then v.mve_placa end ) = '004406'
and a.abastecimiento_anio='2015' and a.abastecimiento_periodo='1')as a
left join
(select
(SELECT count (*) -1
FROM mvabactecimiento_combustible a1
INNER JOIN mv_vehiculo v1 ON a1.mve_secuencial = v1.mve_secuencial
where (case when a1.abastecimiento_kilometraje is null then a1.abastecimiento_horasto
when a1.abastecimiento_kilometraje is not null then cast(a1.abastecimiento_kilometraje as varchar) end ) <= (case when a.abastecimiento_kilometraje is null then a.abastecimiento_horasto
when a.abastecimiento_kilometraje is not null then cast(a.abastecimiento_kilometraje as varchar) end )
and  (case when v1.mve_placa is NULL then v1.mve_codigo when v1.mve_placa is not null then v1.mve_placa end ) = '004406'
and a.abastecimiento_anio='2015' and a.abastecimiento_periodo='1') as numero,
(case when a.abastecimiento_kilometraje is null then substring(a.abastecimiento_horasto,0,5)
when a.abastecimiento_kilometraje is not null then cast(a.abastecimiento_kilometraje as varchar) end ) as recorrido,
(case when v.mve_placa is NULL then v.mve_codigo when v.mve_placa is not null then v.mve_placa end ) AS placa
FROM mvabactecimiento_combustible a
INNER JOIN mv_vehiculo v ON a.mve_secuencial = v.mve_secuencial
where  (case when v.mve_placa is NULL then v.mve_codigo when v.mve_placa is not null then v.mve_placa end ) = '004406'
and a.abastecimiento_anio='2015' and a.abastecimiento_periodo='1'
and (SELECT count (*) -1
FROM mvabactecimiento_combustible a1
INNER JOIN mv_vehiculo v1 ON a1.mve_secuencial = v1.mve_secuencial
where (case when a1.abastecimiento_kilometraje is null then a1.abastecimiento_horasto
when a1.abastecimiento_kilometraje is not null then cast(a1.abastecimiento_kilometraje as varchar) end ) <= (case when a.abastecimiento_kilometraje is null then a.abastecimiento_horasto
when a.abastecimiento_kilometraje is not null then cast(a.abastecimiento_kilometraje as varchar) end )
and  (case when v1.mve_placa is NULL then v1.mve_codigo when v1.mve_placa is not null then v1.mve_placa end ) = '004406'
and a.abastecimiento_anio='2015' and a.abastecimiento_periodo='1') >0
order by numero )as b
on a.placa= b.placa and a.numero = b.numero) as e
on (case when a.mve_placa is NULL then a.mve_codigo when a.mve_placa is not null then a.mve_placa end )=e.placa
and a.abastecimiento_numero= cast(e.numero as varchar)
order by 1]]>
	</queryString>
	<field name="abastecimiento_numero" class="java.math.BigDecimal"/>
	<field name="mve_placa" class="java.lang.String"/>
	<field name="mve_codigo" class="java.lang.String"/>
	<field name="mvtipo_descripcion" class="java.lang.String"/>
	<field name="mvmarca_descripcion" class="java.lang.String"/>
	<field name="mvmodelo_descripcion" class="java.lang.String"/>
	<field name="total" class="java.math.BigDecimal"/>
	<field name="galones" class="java.math.BigDecimal"/>
	<field name="mantenimiento" class="java.math.BigDecimal"/>
	<field name="recorrido" class="java.math.BigDecimal"/>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="98" splitType="Stretch">
			<staticText>
				<reportElement uuid="d1bb8ffe-492c-4b6f-91d0-ab4ad38a55e2" key="staticText" x="0" y="0" width="266" height="43" forecolor="#000000" backcolor="#FFFFFF"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left">
					<font size="12" isBold="true" pdfFontName="Helvetica-Bold"/>
				</textElement>
				<text><![CDATA[GOBIERNO AUTÓNOMO DESCENTRALIZADO MUNICIPAL DEL CANTON RUMIÑAHUI]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="77c8440a-8ab2-461a-9114-9f0db385978e" key="staticText" x="0" y="34" width="266" height="34" forecolor="#000000" backcolor="#FFFFFF"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left">
					<font size="12" isBold="true" pdfFontName="Helvetica-Bold"/>
				</textElement>
				<text><![CDATA[ABATECIMIENTO INDIVIDUAL]]></text>
			</staticText>
		</band>
	</title>
	<pageHeader>
		<band height="16">
			<textField isBlankWhenNull="true">
				<reportElement uuid="d07c164c-9ab8-418f-9472-33d7fc89b49a" x="258" y="0" width="159" height="15"/>
				<textElement verticalAlignment="Top"/>
				<textFieldExpression><![CDATA["MARCA: "+$F{mvmarca_descripcion}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement uuid="cafad310-9c39-4ecb-8176-4dde0eac99e0" x="700" y="0" width="102" height="15"/>
				<textElement/>
				<textFieldExpression><![CDATA["MES: "+$P{mes}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement uuid="7f952af2-5494-492e-b171-7c137119e8d8" x="544" y="0" width="155" height="15"/>
				<textElement verticalAlignment="Top"/>
				<textFieldExpression><![CDATA["MODELO: "+$F{mvmodelo_descripcion}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement uuid="ebdef1f3-c0eb-4a1f-876d-0f272140b683" x="422" y="0" width="117" height="15"/>
				<textElement verticalAlignment="Top"/>
				<textFieldExpression><![CDATA["TIPO: "+$F{mvtipo_descripcion}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement uuid="8035ea7d-ea07-4c75-8286-2279b538efd4" x="0" y="0" width="125" height="15"/>
				<textElement verticalAlignment="Top"/>
				<textFieldExpression><![CDATA["PLACA: "+$F{mve_placa}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement uuid="d125abd8-5d48-4cc5-a61c-00190c51e008" x="125" y="0" width="125" height="15"/>
				<textElement verticalAlignment="Top"/>
				<textFieldExpression><![CDATA["CODIGO: "+$F{mve_codigo}]]></textFieldExpression>
			</textField>
		</band>
	</pageHeader>
	<pageFooter>
		<band height="16" splitType="Stretch">
			<textField pattern="" isBlankWhenNull="false">
				<reportElement uuid="c850be98-e6cc-4b45-8422-fef124a5d324" key="textField" x="569" y="0" width="170" height="15" forecolor="#000000" backcolor="#FFFFFF"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Right">
					<font size="10"/>
				</textElement>
				<textFieldExpression><![CDATA["Página " + $V{PAGE_NUMBER} + " de "]]></textFieldExpression>
			</textField>
			<textField pattern="" isBlankWhenNull="false">
				<reportElement uuid="b1a4bad9-8261-4bbd-9f57-a20fd6bc97ec" key="textField-5" x="13" y="0" width="115" height="15" forecolor="#000000" backcolor="#FFFFFF"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement>
					<font size="10"/>
				</textElement>
				<textFieldExpression><![CDATA[new Date()]]></textFieldExpression>
			</textField>
			<textField evaluationTime="Report" pattern="" isBlankWhenNull="false">
				<reportElement uuid="9cb02e52-1407-4dc9-93a6-1dcca5f979e3" key="textField" x="739" y="0" width="36" height="15" forecolor="#000000" backcolor="#FFFFFF"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement>
					<font size="10"/>
				</textElement>
				<textFieldExpression><![CDATA["" + $V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
		</band>
	</pageFooter>
	<summary>
		<band height="303" splitType="Stretch">
			<bar3DChart>
				<chart>
					<reportElement uuid="69ae3d3c-af62-444d-8404-30a95fa5b4a4" x="0" y="0" width="802" height="303"/>
					<chartTitle/>
					<chartSubtitle/>
					<chartLegend/>
				</chart>
				<categoryDataset>
					<categorySeries>
						<seriesExpression><![CDATA["KM/H"]]></seriesExpression>
						<categoryExpression><![CDATA[$F{abastecimiento_numero}]]></categoryExpression>
						<valueExpression><![CDATA[$F{recorrido}]]></valueExpression>
					</categorySeries>
					<categorySeries>
						<seriesExpression><![CDATA["TOTAL GALONES"]]></seriesExpression>
						<categoryExpression><![CDATA[$F{abastecimiento_numero}]]></categoryExpression>
						<valueExpression><![CDATA[$F{galones}]]></valueExpression>
					</categorySeries>
					<categorySeries>
						<seriesExpression><![CDATA["TOTAL VALOR"]]></seriesExpression>
						<categoryExpression><![CDATA[$F{abastecimiento_numero}]]></categoryExpression>
						<valueExpression><![CDATA[$F{total}]]></valueExpression>
					</categorySeries>
				</categoryDataset>
				<bar3DPlot>
					<plot orientation="Horizontal"/>
					<itemLabel/>
					<categoryAxisFormat>
						<axisFormat/>
					</categoryAxisFormat>
					<valueAxisFormat>
						<axisFormat/>
					</valueAxisFormat>
				</bar3DPlot>
			</bar3DChart>
		</band>
	</summary>
</jasperReport>
